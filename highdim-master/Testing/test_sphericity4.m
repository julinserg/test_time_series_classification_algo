%% Compare JNS to simulations of size and power in
% Wang, Q and Yao J (2013). On the sphericity test with large-dimensional
%   observations. Electronic Journal of Statistics 7: 2164-2192

%% Table 2
clear all;
n = [64 128 256 512];
p{1} = [4  8  16  32  48  56  60];
p{2} = [8  16 32  64  96  112 120];
p{3} = [16 32 64  128 192 224 240];
p{4} = [32 64 128 256 384 448 480];

reps = 20;
tic;
for i = 1:numel(n)
   for j = 1:numel(p{i})
      for k = 1:reps
         x = gamrnd(4,1/2,n(i),p{i}(j))-2;
         %x = randn(n(i),p{i}(j));
         pval(k) = sphere.jsn(x,'test','wang');
      end
      prob(i,j) = mean(pval<=0.05);
   end
   toc
end

pN = [... % Normal(0,1)
0.0498 0.0545 0.0539 0.0558 0.0551 0.0547 0.0523;...
0.0539 0.0523 0.051  0.0538 0.055  0.0543 0.0545;...
0.0544 0.0534 0.0519 0.0507 0.0507 0.0503 0.0494;...
0.0542 0.0512 0.0519 0.0491 0.0487 0.0496 0.0488]

% Normal, reps = 2000, method = 'wang'
% prob =
% 
%     0.0585    0.0645    0.0570    0.0525    0.0485    0.0520    0.0565
%     0.0625    0.0620    0.0605    0.0570    0.0510    0.0480    0.0525
%     0.0570    0.0565    0.0505    0.0550    0.0465    0.0550    0.0545
%     0.0555    0.0540    0.0490    0.0420    0.0510    0.0490    0.0435

% Normal, reps = 2000, method = 'wang'
% prob =
% 
%     0.0565    0.0600    0.0495    0.0445    0.0590    0.0515    0.0605
%     0.0550    0.0575    0.0545    0.0525    0.0470    0.0505    0.0510
%     0.0605    0.0485    0.0540    0.0555    0.0515    0.0545    0.0395
%     0.0530    0.0555    0.0480    0.0485    0.0445    0.0460    0.0525

pG = [... % Gamma(4,2)-2, note parametrization in matlab = gamrnd(4,1/2)
0.0698 0.0804 0.078  0.0703 0.0685 0.0615 0.0615;...
0.075  0.0724 0.0695 0.0603 0.0577 0.0591 0.0598;...
0.0719 0.0634 0.0598 0.0555 0.052  0.0541 0.0533;...
0.0606 0.0579 0.0507 0.0495 0.0502 0.0482 0.053]

% Gamma, reps = 2000, method = 'wang'
% prob =
% 
%     0.0650    0.0590    0.0650    0.0620    0.0580    0.0565    0.0615
%     0.0675    0.0595    0.0680    0.0525    0.0495    0.0580    0.0525
%     0.0645    0.0580    0.0720    0.0495    0.0505    0.0410    0.0540
%     0.0550    0.0575    0.0490    0.0560    0.0535    0.0595    0.0420

% Gamma, reps = 2000, method = 'wang'
% prob =
% 
%     0.0795    0.0660    0.0595    0.0590    0.0520    0.0530    0.0475
%     0.0715    0.0540    0.0645    0.0525    0.0540    0.0585    0.0550
%     0.0615    0.0620    0.0520    0.0610    0.0540    0.0535    0.0580
%     0.0505    0.0610    0.0530    0.0475    0.0520    0.0455    0.0490

%% Table 3
clear all;
n = [64 128];
p{1} = [4  8  16  32  48  56  60];
p{2} = [8  16 32  64  96  112 120];

reps = 250;
tic;
for i = 1:numel(n)
   for j = 1:numel(p{i})
      for k = 1:reps
         %x = gamrnd(4,1/2,n(i),p{i}(j))-2;
         x = randn(n(i),p{i}(j));
         v = round(p{i}(j)/2);
         sigma = [0.5*ones(v,1);ones(p{i}(j)-v,1)]';
         x = (diag(sqrt(sigma))*x')';
         pval(k) = sphere.jsn(x,'test','n');
      end
      prob(i,j) = mean(pval<=0.05);
   end
   toc
end

pN = [... % Normal, Power 1, CJ
0.7754 0.8662 0.912 0.9384 0.9471 0.949 0.9501;...
0.9984 0.9998 1 1 1 1 1]

% Normal, Power 1, reps = 2500, method = 'wang'
% prob =
% 
%     0.8640    0.9256    0.9664    0.9744    0.9840    0.9812    0.9820
%     0.9996    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000

% Normal, Power 1, reps = 2500, method = 'john'
% prob =
% 
%     0.7348    0.8336    0.8876    0.9304    0.9284    0.9364    0.9392
%     0.9980    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000

% Normal, Power 1, reps = 2500, method = 'nagao'
% prob =
% 
%     0.7516    0.8468    0.8876    0.9404    0.9336    0.9308    0.9392
%     0.9992    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000

pN = [... % Normal, Power 2, CJ
0.4694 0.5313 0.5732 0.5868 0.6035 0.6025 0.6048;
0.9424 0.9698 0.9781 0.9823 0.9824 0.9841 0.9844]

% Normal, Power 2, reps = 2500, method = 'wang'
% prob =
% 
%     0.5400    0.5880    0.6460    0.6700    0.6660    0.6752    0.6900
%     0.9720    0.9856    0.9844    0.9908    0.9904    0.9892    0.9920

% Normal, Power 2, reps = 2500, method = 'john'
% prob =
% 
%     0.4412    0.4828    0.5360    0.5720    0.5732    0.5852    0.5696
%     0.9444    0.9584    0.9724    0.9852    0.9836    0.9864    0.9836

% Normal, Power 2, reps = 2500, method = 'nagao'
% prob =
% 
%     0.4596    0.5008    0.5260    0.5520    0.5788    0.5924    0.6016
%     0.9384    0.9540    0.9756    0.9756    0.9836    0.9776    0.9820
